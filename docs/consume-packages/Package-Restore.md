---
title: Restauração de pacote do NuGet
description: Uma visão geral de como o NuGet restaura os pacotes dos quais um projeto depende, incluindo como desabilitar a restauração e restringir as versões.
author: JonDouglas
ms.author: jodou
ms.date: 08/05/2019
ms.topic: conceptual
ms.openlocfilehash: 6cdc826c85f233c7108a53ad244aa8c47df0be67
ms.sourcegitcommit: 40c039ace0330dd9e68922882017f9878f4283d1
ms.translationtype: MT
ms.contentlocale: pt-BR
ms.lasthandoff: 04/22/2021
ms.locfileid: "107901831"
---
# <a name="restore-packages-using-package-restore"></a><span data-ttu-id="23478-103">Restaurar pacotes usando a Restauração de Pacote</span><span class="sxs-lookup"><span data-stu-id="23478-103">Restore packages using Package Restore</span></span>

<span data-ttu-id="23478-104">Para promover um ambiente de desenvolvimento mais limpo e reduzir o tamanho do repositório, a **Restauração de Pacote** do NuGet instala todas as dependências de um projeto listadas no arquivo de projeto ou em `packages.config`.</span><span class="sxs-lookup"><span data-stu-id="23478-104">To promote a cleaner development environment and to reduce repository size, NuGet **Package Restore** installs all of a project's dependencies listed in either the project file or `packages.config`.</span></span> <span data-ttu-id="23478-105">Os comandos `dotnet build` e `dotnet run` do .NET Core 2.0 e posterior fazem uma restauração de pacote automática.</span><span class="sxs-lookup"><span data-stu-id="23478-105">The .NET Core 2.0+ `dotnet build` and `dotnet run` commands do an automatic package restore.</span></span> <span data-ttu-id="23478-106">O Visual Studio pode restaurar pacotes automaticamente quando ele cria um projeto, e você pode restaurar pacotes a qualquer momento por meio do Visual Studio, de `nuget restore`, de `dotnet restore` e do xbuild no Mono.</span><span class="sxs-lookup"><span data-stu-id="23478-106">Visual Studio can restore packages automatically when it builds a project, and you can restore packages at any time through Visual Studio, `nuget restore`, `dotnet restore`, and xbuild on Mono.</span></span>

<span data-ttu-id="23478-107">A Restauração de Pacote garante que todas as dependências de um projeto estejam disponíveis, sem a necessidade de armazená-las no controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="23478-107">Package Restore makes sure that all a project's dependencies are available, without having to store them in source control.</span></span> <span data-ttu-id="23478-108">Para configurar o repositório do controle do código-fonte para excluir os binários do pacote, confira [Pacotes e controle do código-fonte](../consume-packages/packages-and-source-control.md).</span><span class="sxs-lookup"><span data-stu-id="23478-108">To configure your source control repository to exclude the package binaries, see [Packages and source control](../consume-packages/packages-and-source-control.md).</span></span> 

## <a name="package-restore-overview"></a><span data-ttu-id="23478-109">Visão geral da Restauração de Pacote</span><span class="sxs-lookup"><span data-stu-id="23478-109">Package Restore overview</span></span>

<span data-ttu-id="23478-110">Primeiro, a Restauração de Pacote instala as dependências diretas de um projeto, conforme necessário, e, em seguida, instala as dependências desses pacotes em todo o grafo de dependência.</span><span class="sxs-lookup"><span data-stu-id="23478-110">Package Restore first installs the direct dependencies of a project as needed, then installs any dependencies of those packages throughout the entire dependency graph.</span></span>

<span data-ttu-id="23478-111">Se um pacote ainda não estiver instalado, primeiro, o NuGet tentará recuperá-lo do [cache](../consume-packages/managing-the-global-packages-and-cache-folders.md).</span><span class="sxs-lookup"><span data-stu-id="23478-111">If a package isn't already installed, NuGet first attempts to retrieve it from the [cache](../consume-packages/managing-the-global-packages-and-cache-folders.md).</span></span> <span data-ttu-id="23478-112">Se o pacote não estiver no cache, o NuGet tentará baixar o pacote de todas as fontes habilitadas na lista em **ferramentas**  >  **Opções**  >  pacote **Gerenciador de pacotes NuGet**  >  **fontes** no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="23478-112">If the package isn't in the cache, NuGet tries to download the package from all enabled sources in the list at **Tools** > **Options** > **NuGet Package Manager** > **Package Sources** in Visual Studio.</span></span> <span data-ttu-id="23478-113">Durante a restauração, o NuGet ignora a ordem das origens do pacote e usa o pacote de qualquer origem que responder às solicitações primeiro.</span><span class="sxs-lookup"><span data-stu-id="23478-113">During restore, NuGet ignores the order of package sources, and uses the package from whichever source is first to respond to requests.</span></span> <span data-ttu-id="23478-114">Para obter mais informações sobre como o NuGet se comporta, confira [Configurações comuns do NuGet](Configuring-NuGet-Behavior.md).</span><span class="sxs-lookup"><span data-stu-id="23478-114">For more information about how NuGet behaves, see [Common NuGet configurations](Configuring-NuGet-Behavior.md).</span></span> 

> [!Note]
> <span data-ttu-id="23478-115">O NuGet não indicará uma falha na restauração de um pacote enquanto todas as origens não forem verificadas.</span><span class="sxs-lookup"><span data-stu-id="23478-115">NuGet doesn't indicate a failure to restore a package until all the sources have been checked.</span></span> <span data-ttu-id="23478-116">Nesse momento, o NuGet relatará uma falha somente para a última origem na lista.</span><span class="sxs-lookup"><span data-stu-id="23478-116">At that time, NuGet reports a failure for only the last source in the list.</span></span> <span data-ttu-id="23478-117">O erro indica que o pacote não estava presente em *nenhuma* das outras origens, mesmo que os erros não sejam mostrados para cada uma dessas fontes individualmente.</span><span class="sxs-lookup"><span data-stu-id="23478-117">The error implies that the package wasn't present on *any* of the other sources, even though errors aren't shown for each of those sources individually.</span></span>

## <a name="restore-packages"></a><span data-ttu-id="23478-118">Restaurar pacotes</span><span class="sxs-lookup"><span data-stu-id="23478-118">Restore packages</span></span>

<span data-ttu-id="23478-119">A Restauração de Pacote tenta instalar todas as dependências de pacotes no estado correto correspondente às referências de pacote do arquivo de projeto (*.csproj*) ou do arquivo *packages.config*.</span><span class="sxs-lookup"><span data-stu-id="23478-119">Package Restore tries to install all package dependencies to the correct state matching the package references in your project file (*.csproj*) or your *packages.config* file.</span></span> <span data-ttu-id="23478-120">No Visual Studio, as referências aparecem no Gerenciador de Soluções em **Dependências \ NuGet** ou no nó **Referências**.</span><span class="sxs-lookup"><span data-stu-id="23478-120">(In Visual Studio, the references appear in Solution Explorer under the **Dependencies \ NuGet** or the **References** node.)</span></span>

1. <span data-ttu-id="23478-121">Se as referências de pacote no arquivo de projeto estiverem corretas, use sua ferramenta preferida para restaurar os pacotes.</span><span class="sxs-lookup"><span data-stu-id="23478-121">If the package references in your project file are correct, use your preferred tool to restore packages.</span></span>

   - <span data-ttu-id="23478-122">[Visual Studio](#restore-using-visual-studio) ([restauração automática](#restore-packages-automatically-using-visual-studio) ou [restauração manual](#restore-packages-manually-using-visual-studio))</span><span class="sxs-lookup"><span data-stu-id="23478-122">[Visual Studio](#restore-using-visual-studio) ([automatic restore](#restore-packages-automatically-using-visual-studio) or [manual restore](#restore-packages-manually-using-visual-studio))</span></span>
   - [<span data-ttu-id="23478-123">CLI do dotnet</span><span class="sxs-lookup"><span data-stu-id="23478-123">dotnet CLI</span></span>](#restore-using-the-dotnet-cli)
   - [<span data-ttu-id="23478-124">CLI do nuget.exe</span><span class="sxs-lookup"><span data-stu-id="23478-124">nuget.exe CLI</span></span>](#restore-using-the-nugetexe-cli)
   - [<span data-ttu-id="23478-125">MSBuild</span><span class="sxs-lookup"><span data-stu-id="23478-125">MSBuild</span></span>](#restore-using-msbuild)
   - [<span data-ttu-id="23478-126">Azure Pipelines</span><span class="sxs-lookup"><span data-stu-id="23478-126">Azure Pipelines</span></span>](#restore-using-azure-pipelines)
   - [<span data-ttu-id="23478-127">Azure DevOps Server</span><span class="sxs-lookup"><span data-stu-id="23478-127">Azure DevOps Server</span></span>](#restore-using-azure-devops-server)

   <span data-ttu-id="23478-128">Se as referências de pacote no arquivo de projeto (*.csproj*) ou no arquivo *packages.config* estiverem incorretas (não corresponderem ao estado desejado após a Restauração de Pacote), instale ou atualize os pacotes.</span><span class="sxs-lookup"><span data-stu-id="23478-128">If the package references in your project file (*.csproj*) or your *packages.config* file are incorrect (they do not match your desired state following Package Restore), then you need to either install or update packages instead.</span></span>

   <span data-ttu-id="23478-129">Para projetos que usam PackageReference, após uma restauração bem-sucedida, o pacote deve estar presente na pasta *global-packages* e o arquivo `obj/project.assets.json` é recriado.</span><span class="sxs-lookup"><span data-stu-id="23478-129">For projects using PackageReference, after a successful restore, the package should be present in the *global-packages* folder and the `obj/project.assets.json` file is recreated.</span></span> <span data-ttu-id="23478-130">Para projetos que usam `packages.config`, o pacote deve aparecer na pasta `packages` do projeto.</span><span class="sxs-lookup"><span data-stu-id="23478-130">For projects using `packages.config`, the package should appear in the project's `packages` folder.</span></span> <span data-ttu-id="23478-131">Nesse momento, o projeto deverá ser compilado com êxito.</span><span class="sxs-lookup"><span data-stu-id="23478-131">The project should now build successfully.</span></span> 

2. <span data-ttu-id="23478-132">Depois de executar a Restauração de Pacote, se ainda houver pacotes ausentes ou erros relacionados a pacotes (como ícones de erro no Gerenciador de Soluções do Visual Studio), poderá ser necessário seguir as instruções descritas em [Solução de problemas de restauração de pacote](package-restore-troubleshooting.md) ou, como alternativa, [Reinstalar e atualizar os pacotes](../consume-packages/reinstalling-and-updating-packages.md).</span><span class="sxs-lookup"><span data-stu-id="23478-132">After running Package Restore, if you still experience missing packages or package-related errors (such as error icons in Solution Explorer in Visual Studio), you may need to follow instructions described in [Troubleshooting Package Restore errors](package-restore-troubleshooting.md) or, alternatively, [reinstall and update packages](../consume-packages/reinstalling-and-updating-packages.md).</span></span>

   <span data-ttu-id="23478-133">No Visual Studio, o Console do Gerenciador de Pacotes fornece várias opções flexíveis para reinstalar os pacotes.</span><span class="sxs-lookup"><span data-stu-id="23478-133">In Visual Studio, the Package Manager Console provides several flexible options for reinstalling packages.</span></span> <span data-ttu-id="23478-134">Confira [Usar Update-Package](reinstalling-and-updating-packages.md#using-update-package).</span><span class="sxs-lookup"><span data-stu-id="23478-134">See [Using Package-Update](reinstalling-and-updating-packages.md#using-update-package).</span></span>

## <a name="restore-using-visual-studio"></a><span data-ttu-id="23478-135">Restaurar usando o Visual Studio</span><span class="sxs-lookup"><span data-stu-id="23478-135">Restore using Visual Studio</span></span>

<span data-ttu-id="23478-136">No Visual Studio no Windows, siga um destes procedimentos:</span><span class="sxs-lookup"><span data-stu-id="23478-136">In Visual Studio on Windows, either:</span></span>

- <span data-ttu-id="23478-137">Restaurar pacotes automaticamente ou</span><span class="sxs-lookup"><span data-stu-id="23478-137">Restore packages automatically, or</span></span>

- <span data-ttu-id="23478-138">Restaurar pacotes manualmente</span><span class="sxs-lookup"><span data-stu-id="23478-138">Restore packages manually</span></span>

### <a name="restore-packages-automatically-using-visual-studio"></a><span data-ttu-id="23478-139">Restaurar pacotes automaticamente usando o Visual Studio</span><span class="sxs-lookup"><span data-stu-id="23478-139">Restore packages automatically using Visual Studio</span></span>

<span data-ttu-id="23478-140">A Restauração de Pacote ocorre automaticamente quando você cria um projeto com base em um modelo ou compila um projeto, sujeito às opções em [Habilitar e desabilitar a restauração de pacote](#enable-and-disable-package-restore-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="23478-140">Package Restore happens automatically when you create a project from a template or build a project, subject to the options in [Enable and disable package restore](#enable-and-disable-package-restore-in-visual-studio).</span></span> <span data-ttu-id="23478-141">No NuGet 4.0 e posterior, a restauração também ocorre automaticamente quando você faz alterações em um projeto do estilo SDK (normalmente um projeto do .NET Core ou .NET Standard).</span><span class="sxs-lookup"><span data-stu-id="23478-141">In NuGet 4.0+, restore also happens automatically when you make changes to a SDK-style project (typically a .NET Core or .NET Standard project).</span></span>

1. <span data-ttu-id="23478-142">Habilite a restauração automática de pacote escolhendo **ferramentas**  >  **Opções**  >  **Gerenciador de pacotes NuGet** e, em seguida, selecionando **verificar automaticamente se há pacotes ausentes durante a compilação no Visual Studio** em **restauração de pacote**.</span><span class="sxs-lookup"><span data-stu-id="23478-142">Enable automatic package restore by choosing **Tools** > **Options** > **NuGet Package Manager**, and then selecting **Automatically check for missing packages during build in Visual Studio** under **Package Restore**.</span></span>

   <span data-ttu-id="23478-143">Para projetos com estilo diferente do SDK, selecione primeiro **Permitir que o NuGet baixe os pacotes ausentes** para habilitar a opção de restauração automática.</span><span class="sxs-lookup"><span data-stu-id="23478-143">For non-SDK-style projects, you first need to select **Allow NuGet to download missing packages** to enable the automatic restore option.</span></span>

1. <span data-ttu-id="23478-144">Compile o projeto.</span><span class="sxs-lookup"><span data-stu-id="23478-144">Build the project.</span></span>

   <span data-ttu-id="23478-145">Se um ou mais pacotes individuais ainda não estiverem instalados corretamente, o **Gerenciador de Soluções** mostrará um ícone de erro.</span><span class="sxs-lookup"><span data-stu-id="23478-145">If one or more individual packages still aren't installed properly, **Solution Explorer** shows an error icon.</span></span> <span data-ttu-id="23478-146">Clique com o botão direito do mouse e selecione **Gerenciar Pacotes NuGet** e use o **Gerenciador de Pacotes** para desinstalar e reinstalar os pacotes afetados.</span><span class="sxs-lookup"><span data-stu-id="23478-146">Right-click and select **Manage NuGet Packages**, and use **Package Manager** to uninstall and reinstall the affected packages.</span></span> <span data-ttu-id="23478-147">Para obter mais informações, confira [Reinstalar e atualizar pacotes](../consume-packages/reinstalling-and-updating-packages.md)</span><span class="sxs-lookup"><span data-stu-id="23478-147">For more information, see [Reinstall and update packages](../consume-packages/reinstalling-and-updating-packages.md)</span></span>

   <span data-ttu-id="23478-148">Se você receber o erro "Este projeto referencia pacotes NuGet que estão ausentes deste computador" ou "Um ou mais pacotes NuGet precisam ser restaurados, mas não foi possível fazer isso, pois o consentimento não foi dado", [habilite a restauração automática](#enable-and-disable-package-restore-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="23478-148">If you see the error "This project references NuGet package(s) that are missing on this computer," or "One or more NuGet packages need to be restored but couldn't be because consent has not been granted," [enable automatic restore](#enable-and-disable-package-restore-in-visual-studio).</span></span> <span data-ttu-id="23478-149">Para projetos mais antigos, confira também [Migrar para a restauração de pacote automática](#migrate-to-automatic-package-restore-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="23478-149">For older projects, also see [Migrate to automatic package restore](#migrate-to-automatic-package-restore-visual-studio).</span></span> <span data-ttu-id="23478-150">Consulte também [solução de problemas de restauração de pacote](Package-restore-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="23478-150">Also see [Package Restore troubleshooting](Package-restore-troubleshooting.md).</span></span>

### <a name="restore-packages-manually-using-visual-studio"></a><span data-ttu-id="23478-151">Restaurar pacotes manualmente usando o Visual Studio</span><span class="sxs-lookup"><span data-stu-id="23478-151">Restore packages manually using Visual Studio</span></span>

1. <span data-ttu-id="23478-152">Habilite a restauração do pacote escolhendo **ferramentas**  >  **Opções**  >  **Gerenciador de pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="23478-152">Enable package restore by choosing **Tools** > **Options** > **NuGet Package Manager**.</span></span> <span data-ttu-id="23478-153">Nas opções de **Restauração de Pacote**, selecione **Permitir que o NuGet baixe os pacotes ausentes**.</span><span class="sxs-lookup"><span data-stu-id="23478-153">Under **Package Restore** options, select **Allow NuGet to download missing packages**.</span></span>

1. <span data-ttu-id="23478-154">No **Gerenciador de Soluções**, clique com o botão direito do mouse na solução e selecione **Restaurar Pacotes NuGet**.</span><span class="sxs-lookup"><span data-stu-id="23478-154">In **Solution Explorer**, right click the solution and select **Restore NuGet Packages**.</span></span>

   <span data-ttu-id="23478-155">Se um ou mais pacotes individuais ainda não estiverem instalados corretamente, o **Gerenciador de Soluções** mostrará um ícone de erro.</span><span class="sxs-lookup"><span data-stu-id="23478-155">If one or more individual packages still aren't installed properly, **Solution Explorer** shows an error icon.</span></span> <span data-ttu-id="23478-156">Clique com o botão direito do mouse e selecione **Gerenciar Pacotes NuGet** e use o **Gerenciador de Pacotes** para desinstalar e reinstalar os pacotes afetados.</span><span class="sxs-lookup"><span data-stu-id="23478-156">Right-click and select **Manage NuGet Packages**, and then use **Package Manager** to uninstall and reinstall the affected packages.</span></span> <span data-ttu-id="23478-157">Para obter mais informações, confira [Reinstalar e atualizar pacotes](../consume-packages/reinstalling-and-updating-packages.md)</span><span class="sxs-lookup"><span data-stu-id="23478-157">For more information, see [Reinstall and update packages](../consume-packages/reinstalling-and-updating-packages.md)</span></span>

   <span data-ttu-id="23478-158">Se você receber o erro "Este projeto referencia pacotes NuGet que estão ausentes deste computador" ou "Um ou mais pacotes NuGet precisam ser restaurados, mas não foi possível fazer isso, pois o consentimento não foi dado", [habilite a restauração automática](#enable-and-disable-package-restore-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="23478-158">If you see the error "This project references NuGet package(s) that are missing on this computer," or "One or more NuGet packages need to be restored but couldn't be because consent has not been granted," [enable automatic restore](#enable-and-disable-package-restore-in-visual-studio).</span></span> <span data-ttu-id="23478-159">Para projetos mais antigos, confira também [Migrar para a restauração de pacote automática](#migrate-to-automatic-package-restore-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="23478-159">For older projects, also see [Migrate to automatic package restore](#migrate-to-automatic-package-restore-visual-studio).</span></span> <span data-ttu-id="23478-160">Consulte também [solução de problemas de restauração de pacote](Package-restore-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="23478-160">Also see [Package Restore troubleshooting](Package-restore-troubleshooting.md).</span></span>

### <a name="enable-and-disable-package-restore-in-visual-studio"></a><span data-ttu-id="23478-161">Habilitar e desabilitar a restauração de pacote no Visual Studio</span><span class="sxs-lookup"><span data-stu-id="23478-161">Enable and disable package restore in Visual Studio</span></span>

<span data-ttu-id="23478-162">No Visual Studio, você controla a restauração de pacotes principalmente por meio das opções de **ferramentas**  >    >  **Gerenciador de pacotes NuGet**:</span><span class="sxs-lookup"><span data-stu-id="23478-162">In Visual Studio, you control Package Restore primarily through **Tools** > **Options** > **NuGet Package Manager**:</span></span>

![Controlar a Restauração de Pacote por meio das opções do Gerenciador de Pacotes NuGet](media/Restore-01-AutoRestoreOptions.png)

- <span data-ttu-id="23478-164">A configuração **Permitir que o NuGet baixe os pacotes ausentes** controla todas as formas de restauração de pacote alterando a configuração `packageRestore/enabled` na [seção packageRestore](../reference/nuget-config-file.md#packagerestore-section) do arquivo `NuGet.Config`, em `%AppData%\NuGet\` no Windows ou `~/.nuget/NuGet/` no Mac/Linux.</span><span class="sxs-lookup"><span data-stu-id="23478-164">**Allow NuGet to download missing packages** controls all forms of package restore by changing the `packageRestore/enabled` setting in the [packageRestore section](../reference/nuget-config-file.md#packagerestore-section) of the `NuGet.Config` file, at `%AppData%\NuGet\` on Windows, or `~/.nuget/NuGet/` on Mac/Linux.</span></span> <span data-ttu-id="23478-165">Essa configuração também habilita o comando **Restaurar Pacotes NuGet** no menu de contexto da solução no Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="23478-165">This setting also enables the **Restore NuGet Packages** command on the solution's context menu in Visual Studio, .</span></span>

    ```xml
    <configuration>
        <packageRestore>
            <!-- The 'enabled' key is True when the "Allow NuGet to download missing packages" checkbox is set.
                 Clearing the box sets this to False, disabling command-line, automatic, and MSBuild-integrated restore. -->
            <add key="enabled" value="True" />
        </packageRestore>
    </configuration>
    ```
    
  > [!Note]
  > <span data-ttu-id="23478-166">Para substituir globalmente a configuração `packageRestore/enabled`, defina a variável de ambiente **EnableNuGetPackageRestore** com um valor igual a True ou False antes de iniciar o Visual Studio ou um build.</span><span class="sxs-lookup"><span data-stu-id="23478-166">To globally override the `packageRestore/enabled` setting, set the environment variable **EnableNuGetPackageRestore** with a value of True or False before launching Visual Studio or starting a build.</span></span>

- <span data-ttu-id="23478-167">A configuração **Verificar automaticamente os pacotes ausentes durante o build no Visual Studio** controla a restauração automática alterando a configuração `packageRestore/automatic` na [seção packageRestore](../reference/nuget-config-file.md#packagerestore-section) do arquivo `NuGet.Config`.</span><span class="sxs-lookup"><span data-stu-id="23478-167">**Automatically check for missing packages during build in Visual Studio** controls automatic restore by changing the `packageRestore/automatic` setting in the [packageRestore section](../reference/nuget-config-file.md#packagerestore-section) of the `NuGet.Config` file.</span></span> <span data-ttu-id="23478-168">Quando essa opção é definida como True, a execução de um build no Visual Studio restaura automaticamente todos os pacotes ausentes.</span><span class="sxs-lookup"><span data-stu-id="23478-168">When this option is set to True, running a build from Visual Studio automatically restores any missing packages.</span></span> <span data-ttu-id="23478-169">Essa configuração não afeta os builds executados na linha de comando do MSBuild.</span><span class="sxs-lookup"><span data-stu-id="23478-169">This setting doesn't affect builds run from the MSBuild command line.</span></span>

    ```xml
    ...
    <configuration>
        <packageRestore>
            <!-- The 'automatic' key is set to True when the "Automatically check for missing packages during
                 build in Visual Studio" checkbox is set. Clearing the box sets this to False and disables
                 automatic restore. -->
            <add key="automatic" value="True" />
        </packageRestore>
    </configuration>
    ```

<span data-ttu-id="23478-170">Para habilitar ou desabilitar a Restauração de Pacote para todos os usuários em um computador, um desenvolvedor ou uma empresa pode adicionar as definições de configuração ao arquivo `nuget.config` global.</span><span class="sxs-lookup"><span data-stu-id="23478-170">To enable or disable Package Restore for all users on a computer, a developer or company can add the configuration settings to the global `nuget.config` file.</span></span> <span data-ttu-id="23478-171">O `nuget.config` global está no Windows em `%ProgramData%\NuGet\Config`, às vezes, em uma pasta `\{IDE}\{Version}\{SKU}\` específica do Visual Studio ou no Mac/Linux em `~/.local/share`.</span><span class="sxs-lookup"><span data-stu-id="23478-171">The global `nuget.config` is in Windows at `%ProgramData%\NuGet\Config`, sometimes under a specific `\{IDE}\{Version}\{SKU}\` Visual Studio folder, or in Mac/Linux at `~/.local/share`.</span></span> <span data-ttu-id="23478-172">Usuários individuais poderão, então, habilitar seletivamente a restauração conforme necessário no nível do projeto.</span><span class="sxs-lookup"><span data-stu-id="23478-172">Individual users can then selectively enable restore as needed on a project level.</span></span> <span data-ttu-id="23478-173">Para obter mais detalhes sobre como o NuGet prioriza vários arquivos de configuração, confira [Configurações comuns do NuGet](../consume-packages/configuring-nuget-behavior.md#how-settings-are-applied).</span><span class="sxs-lookup"><span data-stu-id="23478-173">For more details on how NuGet prioritizes multiple config files, see [Common NuGet configurations](../consume-packages/configuring-nuget-behavior.md#how-settings-are-applied).</span></span>

> [!Important]
> <span data-ttu-id="23478-174">Se você editar as configurações de `packageRestore` diretamente em `nuget.config`, reinicie o Visual Studio para que a caixa de diálogo **Opções** mostre os valores atuais.</span><span class="sxs-lookup"><span data-stu-id="23478-174">If you edit the `packageRestore` settings directly in `nuget.config`, restart Visual Studio, so that the **Options** dialog box shows the current values.</span></span>

### <a name="choose-default-package-management-format"></a><span data-ttu-id="23478-175">Escolher formato de gerenciamento de pacotes padrão</span><span class="sxs-lookup"><span data-stu-id="23478-175">Choose default package management format</span></span>

![Controlar o formato de gerenciamento de pacotes padrão, embora as opções do Gerenciador de pacotes NuGet](media/Restore-02-PackageFormatOptions.png)

<span data-ttu-id="23478-177">O NuGet tem dois formatos nos quais um projeto pode usar pacotes: [`PackageReference`](package-references-in-project-files.md) e [`packages.config`](../reference/packages-config.md) .</span><span class="sxs-lookup"><span data-stu-id="23478-177">NuGet has two formats in which a project may use packages: [`PackageReference`](package-references-in-project-files.md) and [`packages.config`](../reference/packages-config.md).</span></span> <span data-ttu-id="23478-178">O formato padrão pode ser selecionado na lista suspensa no cabeçalho **Gerenciamento de pacotes** .</span><span class="sxs-lookup"><span data-stu-id="23478-178">The default format can be selected from the drop-down under the **Package Management** heading.</span></span> <span data-ttu-id="23478-179">Uma opção a ser solicitada quando o primeiro pacote é instalado em um projeto também está disponível.</span><span class="sxs-lookup"><span data-stu-id="23478-179">An option to be prompted when the first package is installed in a project is also available.</span></span>

> [!Note]
> <span data-ttu-id="23478-180">Se um projeto não oferecer suporte aos dois formatos de gerenciamento de pacote, o formato de gerenciamento de pacote usado será o que é compatível com o projeto e, portanto, pode não ser o padrão definido nas opções.</span><span class="sxs-lookup"><span data-stu-id="23478-180">If a project does not support both package management formats, the package management format used will be the one that's compatible with the project, and therefore may not be the default set in the options.</span></span> <span data-ttu-id="23478-181">Além disso, o NuGet não solicitará seleção na instalação do primeiro pacote, mesmo se a opção estiver selecionada na janela Opções.</span><span class="sxs-lookup"><span data-stu-id="23478-181">Additionally, NuGet will not prompt for selection on first package installation, even if the option is selected in the options window.</span></span>
>
> <span data-ttu-id="23478-182">Se o console do Gerenciador de pacotes for usado para instalar o primeiro pacote em um projeto, o NuGet não solicitará a seleção de formato, mesmo que a opção esteja selecionada na janela Opções.</span><span class="sxs-lookup"><span data-stu-id="23478-182">If Package Manager Console is used to install the first package in a project, NuGet will not prompt for format selection, even if the option is selected in the options window.</span></span>

## <a name="restore-using-the-dotnet-cli"></a><span data-ttu-id="23478-183">Restaurar usando a CLI do dotnet</span><span class="sxs-lookup"><span data-stu-id="23478-183">Restore using the dotnet CLI</span></span>

[!INCLUDE [restore-dotnet-cli](includes/restore-dotnet-cli.md)]

> [!IMPORTANT]
> <span data-ttu-id="23478-184">Para adicionar uma referência de pacote ausente ao arquivo de projeto, use [dotnet add package](/dotnet/core/tools/dotnet-add-package?tabs=netcore2x), que também executa o comando `restore`.</span><span class="sxs-lookup"><span data-stu-id="23478-184">To add a missing package reference to the project file, use [dotnet add package](/dotnet/core/tools/dotnet-add-package?tabs=netcore2x), which also runs the `restore` command.</span></span>

## <a name="restore-using-the-nugetexe-cli"></a><span data-ttu-id="23478-185">Restaurar usando a CLI nuget.exe</span><span class="sxs-lookup"><span data-stu-id="23478-185">Restore using the nuget.exe CLI</span></span>

[!INCLUDE [restore-nuget-exe-cli](includes/restore-nuget-exe-cli.md)]

> [!IMPORTANT]
> <span data-ttu-id="23478-186">O `restore` comando não modifica um arquivo de projeto ou *packages.config*. Para adicionar uma dependência, adicione um pacote por meio da interface do usuário ou console do Gerenciador de pacotes no Visual Studio ou modifique *packages.config* e, em seguida, execute um `install` ou o `restore` .</span><span class="sxs-lookup"><span data-stu-id="23478-186">The `restore` command does not modify a project file or *packages.config*. To add a dependency, either add a package through the Package Manager UI or Console in Visual Studio, or modify *packages.config* and then run either `install` or `restore`.</span></span>

## <a name="restore-using-msbuild"></a><span data-ttu-id="23478-187">Restaurar usando o MSBuild</span><span class="sxs-lookup"><span data-stu-id="23478-187">Restore using MSBuild</span></span>

<span data-ttu-id="23478-188">Use o comando [MSBuild-t:Restore](../reference/msbuild-targets.md#restore-target) para restaurar os pacotes listados no arquivo de projeto (consulte [PackageReference](package-references-in-project-files.md)) e começando com o MSBuild los +, `packages.config` projetos.</span><span class="sxs-lookup"><span data-stu-id="23478-188">Use the [msbuild -t:restore](../reference/msbuild-targets.md#restore-target) command to restore packages listed in the project file (see [PackageReference](package-references-in-project-files.md)) and starting with MSBuild 16.5+, `packages.config` projects.</span></span>

 <span data-ttu-id="23478-189">Esse comando só está disponível no NuGet 4.x e posterior e no MSBuild 15.1 e posterior, que estão incluídos no Visual Studio 2017 e em versões superiores.</span><span class="sxs-lookup"><span data-stu-id="23478-189">This command is available only in NuGet 4.x+ and MSBuild 15.1+, which are included with Visual Studio 2017 and higher versions.</span></span>
<span data-ttu-id="23478-190">A partir do MSBuild e +, esse comando também pode restaurar `packages.config` projetos baseados quando executado com o `-p:RestorePackagesConfig=true` .</span><span class="sxs-lookup"><span data-stu-id="23478-190">Starting with MSBuild 16.5+, this command can also restore `packages.config` based projects when run with `-p:RestorePackagesConfig=true`.</span></span>

1. <span data-ttu-id="23478-191">Abra um prompt de comando do Desenvolvedor (na caixa **Pesquisar**, digite **Prompt de Comando do Desenvolvedor**).</span><span class="sxs-lookup"><span data-stu-id="23478-191">Open a Developer command prompt (In the **Search** box, type **Developer command prompt**).</span></span>

   <span data-ttu-id="23478-192">Você normalmente deseja iniciar o Prompt de Comando do Desenvolvedor para Visual Studio usando o menu **Iniciar**, pois ele estará configurado com todos os caminhos necessários para o MSBuild.</span><span class="sxs-lookup"><span data-stu-id="23478-192">You typically want to start the Developer Command Prompt for Visual Studio from the **Start** menu, as it will be configured with all the necessary paths for MSBuild.</span></span>

2. <span data-ttu-id="23478-193">Alterne para a pasta que contém o arquivo de projeto e digite o comando a seguir.</span><span class="sxs-lookup"><span data-stu-id="23478-193">Switch to the folder containing the project file and type the following command.</span></span>

   ```cmd
   # Uses the project file in the current folder by default
   msbuild -t:restore
   ```

3. <span data-ttu-id="23478-194">Digite o comando a seguir para recompilar o projeto.</span><span class="sxs-lookup"><span data-stu-id="23478-194">Type the following command to rebuild the project.</span></span>

   ```cmd
   msbuild
   ```

   <span data-ttu-id="23478-195">Verifique se a saída de MSBuild indica que a compilação foi concluída com êxito.</span><span class="sxs-lookup"><span data-stu-id="23478-195">Make sure that the MSBuild output indicates that the build completed successfully.</span></span>
   
> [!Note]
> <span data-ttu-id="23478-196">o MSBuild tem uma `-restore` opção que será executada `Restore` , recarregará o projeto e, em seguida, compilará.</span><span class="sxs-lookup"><span data-stu-id="23478-196">msbuild has a `-restore` switch which will run `Restore`, reload the project, and then build.</span></span> <span data-ttu-id="23478-197">Consulte [restaurando e compilando com um comando do MSBuild](../reference/msbuild-targets.md#restoring-and-building-with-one-msbuild-command).</span><span class="sxs-lookup"><span data-stu-id="23478-197">See [Restoring and building with one MSBuild command](../reference/msbuild-targets.md#restoring-and-building-with-one-msbuild-command).</span></span>

```cmd
# Will restore the project, then build, since build is the default target.
msbuild -restore
```

## <a name="restore-using-azure-pipelines"></a><span data-ttu-id="23478-198">Restaurar usando o Azure Pipelines</span><span class="sxs-lookup"><span data-stu-id="23478-198">Restore using Azure Pipelines</span></span>

<span data-ttu-id="23478-199">Ao criar uma definição de build no Azure Pipelines, inclua a tarefa [restore](/azure/devops/pipelines/tasks/package/nuget#restore-nuget-packages) do NuGet ou a tarefa [restore](/azure/devops/pipelines/tasks/build/dotnet-core-cli) do .NET Core na definição antes de qualquer tarefa de build.</span><span class="sxs-lookup"><span data-stu-id="23478-199">When you create a build definition in Azure Pipelines, include the NuGet [restore](/azure/devops/pipelines/tasks/package/nuget#restore-nuget-packages) or .NET Core [restore](/azure/devops/pipelines/tasks/build/dotnet-core-cli) task in the definition before any build tasks.</span></span> <span data-ttu-id="23478-200">Alguns modelos de build incluem a tarefa de restauração por padrão.</span><span class="sxs-lookup"><span data-stu-id="23478-200">Some build templates include the restore task by default.</span></span>

## <a name="restore-using-azure-devops-server"></a><span data-ttu-id="23478-201">Restaurar usando o Azure DevOps Server</span><span class="sxs-lookup"><span data-stu-id="23478-201">Restore using Azure DevOps Server</span></span>

<span data-ttu-id="23478-202">O Azure DevOps Server e o TFS 2013 e posterior restaurarão pacotes automaticamente durante o build se você estiver usando um modelo do Team Build do TFS 2013 ou posterior.</span><span class="sxs-lookup"><span data-stu-id="23478-202">Azure DevOps Server and TFS 2013 and later automatically restore packages during build, if you're using a TFS 2013 or later Team Build template.</span></span> <span data-ttu-id="23478-203">Para versões anteriores do TFS, você pode incluir uma etapa de build para executar uma opção de restauração de linha de comando ou, opcionalmente, migrar o modelo de build para uma versão posterior.</span><span class="sxs-lookup"><span data-stu-id="23478-203">For earlier TFS versions, you can include a build step to run a command-line restore option, or optionally migrate the build template to a later version.</span></span> <span data-ttu-id="23478-204">Para obter mais informações, confira [Configurar a restauração de pacote com o Team Foundation Build](../consume-packages/team-foundation-build.md).</span><span class="sxs-lookup"><span data-stu-id="23478-204">For more information, see [Set up package restore with Team Foundation Build](../consume-packages/team-foundation-build.md).</span></span>

## <a name="constrain-package-versions-with-restore"></a><span data-ttu-id="23478-205">Restringir as versões do pacote com a restauração</span><span class="sxs-lookup"><span data-stu-id="23478-205">Constrain package versions with restore</span></span>

<span data-ttu-id="23478-206">Quando o NuGet restaura pacotes por meio de qualquer método, ele respeita todas as restrições especificadas em `packages.config` ou no arquivo de projeto:</span><span class="sxs-lookup"><span data-stu-id="23478-206">When NuGet restores packages through any method, it honors any constraints you specified in `packages.config` or the project file:</span></span>

- <span data-ttu-id="23478-207">Em `packages.config`, você pode especificar um intervalo de versão na propriedade `allowedVersion` da dependência.</span><span class="sxs-lookup"><span data-stu-id="23478-207">In `packages.config`, you can specify a version range in the `allowedVersion` property of the dependency.</span></span> <span data-ttu-id="23478-208">Confira [Restringir as versões de atualização](../consume-packages/reinstalling-and-updating-packages.md#constraining-upgrade-versions) para obter mais informações.</span><span class="sxs-lookup"><span data-stu-id="23478-208">See [Constrain upgrade versions](../consume-packages/reinstalling-and-updating-packages.md#constraining-upgrade-versions) for more information.</span></span> <span data-ttu-id="23478-209">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="23478-209">For example:</span></span>

    ```xml
    <package id="Newtonsoft.json" version="6.0.4" allowedVersions="[6,7)" />
    ```

- <span data-ttu-id="23478-210">Em um arquivo de projeto, você pode usar PackageReference para especificar o intervalo de uma dependência diretamente.</span><span class="sxs-lookup"><span data-stu-id="23478-210">In a project file, you can use PackageReference to specify a dependency's range directly.</span></span> <span data-ttu-id="23478-211">Por exemplo:</span><span class="sxs-lookup"><span data-stu-id="23478-211">For example:</span></span>

    ```xml
    <PackageReference Include="Newtonsoft.json" Version="[6, 7)" />
    ```

<span data-ttu-id="23478-212">Em todo os casos, use a notação descrita em [Controle de versão do pacote](../concepts/package-versioning.md).</span><span class="sxs-lookup"><span data-stu-id="23478-212">In all cases, use the notation described in [Package versioning](../concepts/package-versioning.md).</span></span>

## <a name="force-restore-from-package-sources"></a><span data-ttu-id="23478-213">Forçar a restauração em origens do pacote</span><span class="sxs-lookup"><span data-stu-id="23478-213">Force restore from package sources</span></span>

<span data-ttu-id="23478-214">Por padrão, as operações de restauração do NuGet usam pacotes das pastas *global-packages* e *http-cache*, que são descritas em [Gerenciar os pacotes globais e as pastas de cache](managing-the-global-packages-and-cache-folders.md).</span><span class="sxs-lookup"><span data-stu-id="23478-214">By default, NuGet restore operations use packages from the *global-packages* and *http-cache* folders, which are described in [Manage the global packages and cache folders](managing-the-global-packages-and-cache-folders.md).</span></span>

<span data-ttu-id="23478-215">Para evitar o uso da pasta *global-packages*, siga um destes procedimentos:</span><span class="sxs-lookup"><span data-stu-id="23478-215">To avoid using the *global-packages* folder, do one of the following:</span></span>

- <span data-ttu-id="23478-216">Limpe a pasta usando `nuget locals global-packages -clear` ou `dotnet nuget locals global-packages --clear`.</span><span class="sxs-lookup"><span data-stu-id="23478-216">Clear the folder using `nuget locals global-packages -clear` or `dotnet nuget locals global-packages --clear`.</span></span>
- <span data-ttu-id="23478-217">Altere temporariamente o local da pasta *global-Packages* antes da operação de restauração, usando um dos seguintes métodos:</span><span class="sxs-lookup"><span data-stu-id="23478-217">Temporarily change the location of the *global-packages* folder before the restore operation, using one of the following methods:</span></span>
  - <span data-ttu-id="23478-218">Defina a variável de ambiente NUGET_PACKAGES para uma pasta diferente.</span><span class="sxs-lookup"><span data-stu-id="23478-218">Set the NUGET_PACKAGES environment variable to a different folder.</span></span>
  - <span data-ttu-id="23478-219">Crie um arquivo `NuGet.Config` que define `globalPackagesFolder` (se você estiver usando PackageReference) ou `repositoryPath` (se você estiver usando `packages.config`) em outra pasta.</span><span class="sxs-lookup"><span data-stu-id="23478-219">Create a `NuGet.Config` file that sets `globalPackagesFolder` (if using PackageReference) or `repositoryPath` (if using `packages.config`) to a different folder.</span></span> <span data-ttu-id="23478-220">Para obter mais informações, confira [Definições de configuração](../reference/nuget-config-file.md#config-section).</span><span class="sxs-lookup"><span data-stu-id="23478-220">For more information, see [configuration settings](../reference/nuget-config-file.md#config-section).</span></span>
  - <span data-ttu-id="23478-221">Somente MSBuild: especifique uma pasta diferente com a `RestorePackagesPath` propriedade.</span><span class="sxs-lookup"><span data-stu-id="23478-221">MSBuild only: Specify a different folder with the `RestorePackagesPath` property.</span></span>

<span data-ttu-id="23478-222">Para evitar o uso do cache para origens HTTP, siga um destes procedimentos:</span><span class="sxs-lookup"><span data-stu-id="23478-222">To avoid using the cache for HTTP sources, do one of the following:</span></span>

- <span data-ttu-id="23478-223">Use a opção `-NoCache` com `nuget restore` ou a opção `--no-cache` com `dotnet restore`.</span><span class="sxs-lookup"><span data-stu-id="23478-223">Use the `-NoCache` option with `nuget restore`, or the `--no-cache` option with `dotnet restore`.</span></span> <span data-ttu-id="23478-224">Essas opções não afetam as operações de restauração por meio do console ou do Gerenciador de Pacotes do Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="23478-224">These options don't affect restore operations through the Visual Studio Package Manager or console.</span></span>
- <span data-ttu-id="23478-225">Limpe o cache usando `nuget locals http-cache -clear` ou `dotnet nuget locals http-cache --clear`.</span><span class="sxs-lookup"><span data-stu-id="23478-225">Clear the cache using `nuget locals http-cache -clear` or `dotnet nuget locals http-cache --clear`.</span></span>
- <span data-ttu-id="23478-226">Defina temporariamente a variável de ambiente NUGET_HTTP_CACHE_PATH como outra pasta.</span><span class="sxs-lookup"><span data-stu-id="23478-226">Temporarily set the NUGET_HTTP_CACHE_PATH environment variable to a different folder.</span></span>

## <a name="migrate-to-automatic-package-restore-visual-studio"></a><span data-ttu-id="23478-227">Migrar para restauração automática de pacote (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="23478-227">Migrate to automatic package restore (Visual Studio)</span></span>

<span data-ttu-id="23478-228">Para o NuGet 2.6 e anterior, havia suporte para uma restauração de pacote integrada ao MSBuild, mas isso não é mais verdade.</span><span class="sxs-lookup"><span data-stu-id="23478-228">For NuGet 2.6 and earlier, an MSBuild-integrated package restore was previously supported but that is no longer true.</span></span> <span data-ttu-id="23478-229">Normalmente, ele era habilitado clicando com o botão direito do mouse em uma solução no Visual Studio e selecionando **Habilitar restauração de pacote do NuGet**.</span><span class="sxs-lookup"><span data-stu-id="23478-229">(It was typically enabled by right-clicking a solution in Visual Studio and selecting **Enable NuGet Package Restore**).</span></span> <span data-ttu-id="23478-230">Se o seu projeto usa a restauração de pacote integrada do MSBuild preterida, migre para a restauração automática de pacote.</span><span class="sxs-lookup"><span data-stu-id="23478-230">If your project uses the deprecated MSBuild-integrated package restore, please migrate to automatic package restore.</span></span>

<span data-ttu-id="23478-231">Os projetos que usam MSBuild-Integrated restauração de pacote normalmente contêm uma pasta *. NuGet* com três arquivos: *NuGet.config*, *nuget.exe* e *NuGet. targets*.</span><span class="sxs-lookup"><span data-stu-id="23478-231">Projects that use MSBuild-Integrated package restore typically contain a *.nuget* folder with three files: *NuGet.config*, *nuget.exe*, and *NuGet.targets*.</span></span> <span data-ttu-id="23478-232">A presença de um arquivo *NuGet. targets* determina se o NuGet continuará a usar a abordagem integrada ao MSBuild, portanto, esse arquivo deve ser removido durante a migração.</span><span class="sxs-lookup"><span data-stu-id="23478-232">The presence of a *NuGet.targets* file determines whether NuGet will continue to use the MSBuild-integrated approach, so this file must be removed during the migration.</span></span>

<span data-ttu-id="23478-233">Para migrar para restauração automática de pacote:</span><span class="sxs-lookup"><span data-stu-id="23478-233">To migrate to automatic package restore:</span></span>

1. <span data-ttu-id="23478-234">Feche o Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="23478-234">Close Visual Studio.</span></span>
2. <span data-ttu-id="23478-235">Exclua *.nuget/nuget.exe* e *.nuget/NuGet.targets*.</span><span class="sxs-lookup"><span data-stu-id="23478-235">Delete *.nuget/nuget.exe* and *.nuget/NuGet.targets*.</span></span>
3. <span data-ttu-id="23478-236">Para cada arquivo de projeto, remova o elemento `<RestorePackages>` e qualquer referência a *NuGet.targets*.</span><span class="sxs-lookup"><span data-stu-id="23478-236">For each project file, remove the `<RestorePackages>` element and remove any reference to *NuGet.targets*.</span></span>

<span data-ttu-id="23478-237">Para testar a restauração automática de pacote:</span><span class="sxs-lookup"><span data-stu-id="23478-237">To test the automatic package restore:</span></span>

1. <span data-ttu-id="23478-238">Remova a pasta *packages* da solução.</span><span class="sxs-lookup"><span data-stu-id="23478-238">Remove the *packages* folder from the solution.</span></span>
2. <span data-ttu-id="23478-239">Abra a solução no Visual Studio e inicie uma compilação.</span><span class="sxs-lookup"><span data-stu-id="23478-239">Open the solution in Visual Studio and start a build.</span></span>

   <span data-ttu-id="23478-240">A restauração automática de pacote deve baixar e instalar cada pacote de dependência, sem adicioná-los ao controle do código-fonte.</span><span class="sxs-lookup"><span data-stu-id="23478-240">Automatic package restore should download and install each dependency package, without adding them to source control.</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="23478-241">Solução de problemas</span><span class="sxs-lookup"><span data-stu-id="23478-241">Troubleshooting</span></span>

<span data-ttu-id="23478-242">Confira [Solução de problemas de erros de restauração de pacote](Package-restore-troubleshooting.md).</span><span class="sxs-lookup"><span data-stu-id="23478-242">See [Troubleshoot package restore](Package-restore-troubleshooting.md).</span></span>
